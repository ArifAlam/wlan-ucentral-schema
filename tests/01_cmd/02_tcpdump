Testing the tcpdump module with network argument.

-- Testcase --
{% include("./tests/mock.uc", { TESTFILE: "../cmd/cmd.uc" }) %}
-- End --

-- Environment --
cmd={ "command": "trace", "payload": { "network": "testnet" }}
-- End --

-- Expect stdout --
ctx.call() object <network.interface> method <status> args <{ "interface": "testnet" }>
fs.stat() path </sys/class/net/br-testnet>
time()
system() command <[ "tcpdump", "-c", 1000, "-W", "1", "-G", 30, "-w", "/tmp/pcap-001122334455-1615382640", "-i", "br-testnet" ]> timeout <(null)>
ctx.call() object <ucentral> method <upload> args <{ "file": "/tmp/pcap-001122334455-1615382640", "path": null, "uuid": null }>
fs.unlink() path </tmp/pcap-001122334455-1615382640>
ctx.call() object <ucentral> method <result> args <{ "id": 0, "status": { /* 4 keys */ } }>
-- End --

-- Expect stderr --
Success
Uploading file
-- End --


Testing the tcpdump module with iface argument.

-- Testcase --
{% include("./tests/mock.uc", { TESTFILE: "../cmd/cmd.uc" }) %}
-- End --

-- Environment --
cmd={ "command": "trace", "payload": { "iface": "eth2" }}
-- End --

-- Expect stdout --
fs.stat() path </sys/class/net/eth2>
time()
system() command <[ "tcpdump", "-c", 1000, "-W", "1", "-G", 30, "-w", "/tmp/pcap-001122334455-1615382640", "-i", "eth2" ]> timeout <(null)>
ctx.call() object <ucentral> method <upload> args <{ "file": "/tmp/pcap-001122334455-1615382640", "path": null, "uuid": null }>
fs.unlink() path </tmp/pcap-001122334455-1615382640>
ctx.call() object <ucentral> method <result> args <{ "id": 0, "status": { /* 4 keys */ } }>
-- End --

-- Expect stderr --
Success
Uploading file
-- End --


Testing the tcpdump module with incomplete arguments.

-- Testcase --
{% include("./tests/mock.uc", { TESTFILE: "../cmd/cmd.uc" }) %}
-- End --

-- Environment --
cmd={ "command": "trace", "payload": { } }
-- End --

-- Expect stdout --
ctx.call() object <ucentral> method <result> args <{ "id": 0, "status": { /* 4 keys */ } }>
-- End --

-- Expect stderr --
Failed
Invalid network device specified
-- End --
