Testing the factory module with backup retention.

-- Testcase --
{% include("./tests/mock.uc", { TESTFILE: "../cmd/cmd.uc" }) %}
-- End --

-- Environment --
cmd={ "command": "factory", "payload": {"keep_redirector": true }}
id=1
-- End --

-- Expect stdout --
fs.stat() path </etc/ucentral/cert.key>
fs.stat() path </etc/ucentral/cert.pem>
fs.stat() path </etc/ucentral/redirector.json>
fs.stat() path </etc/ucentral/dev-id>
fs.readlink() path </etc/ucentral/ucentral.active>
system() command <[ "tar", "czf", "/sysupgrade.tgz", "/etc/config/ucentral", "/etc/ucentral/cert.key", "/etc/ucentral/cert.pem", "/etc/ucentral/redirector.json", "/etc/ucentral/dev-id", "/etc/ucentral/ucentral.active", "/etc/ucentral/ucentral.active-link" ]> timeout <(null)>
system() command <[ "jffs2reset", "-r", "-y", "-k" ]> timeout <(null)>
-- End --


Testing the factory module without backup retention.

-- Testcase --
{{ include("./tests/mock.uc", { TESTFILE: "../cmd/cmd.uc" }) }}
-- End --

-- Environment --
cmd={ "command": "factory", "payload": {"keep_redirector": false }}
id=1
-- End --

-- Expect stdout --
system() command <[ "jffs2reset", "-r", "-y" ]> timeout <(null)>

-- End --
